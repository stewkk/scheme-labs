<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-12-10 Fri 00:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Домашнее задание №4</title>
<meta name="author" content="Starovoytov Alexandr" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Домашнее задание №4</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#мемоизация">1. 1. Мемоизация</a>
<ul>
<li><a href="#org263335e">1.1. Решение</a></li>
<li><a href="#org3549189">1.2. Тесты</a></li>
</ul>
</li>
<li><a href="#отложенные-вычисления">2. 2. Отложенные вычисления</a></li>
<li><a href="#чтение-из-потока">3. 3. Чтение из потока</a>
<ul>
<li><a href="#org93d9122">3.1. Решение</a></li>
<li><a href="#org3e8c231">3.2. Тесты</a></li>
</ul>
</li>
<li><a href="#структуры-записи">4. 4. Структуры (записи)</a>
<ul>
<li><a href="#orge07b145">4.1. Решение</a></li>
<li><a href="#org8bc108e">4.2. Тесты</a></li>
</ul>
</li>
<li><a href="#алгебраические-типы-данных">5. 5. Алгебраические типы данных</a>
<ul>
<li><a href="#org8e0d02a">5.1. Решение</a></li>
<li><a href="#org8823312">5.2. Тесты</a></li>
</ul>
</li>
<li><a href="#ачивки">6. «Ачивки»</a></li>
</ul>
</div>
</div>
<div id="outline-container-мемоизация" class="outline-2">
<h2 id="мемоизация"><span class="section-number-2">1.</span> 1. Мемоизация</h2>
<div class="outline-text-2" id="text-мемоизация">
<p>
Реализуйте рекурсивные вычисления с использованием оптимизационных
техник &#x2014; мемоизации результатов вычислений и отложенных вычислений.
</p>

<p>
<b>Важно!</b> Eсли в программе используются гигиенические макросы и эта
программа будет выполнена в среде guile 1.8.x (в том числе на сервере
тестирования), то следует подключить модуль поддержки таких макросов,
написав в начале программы следующую строку:
</p>

<pre class="example" id="orgfffe919">
  (use-syntax (ice-9 syncase))
</pre>

<p>
Реализуйте процедуру <i>memoized-factorial</i> для вычисления факториала по
рекурсивной формуле с мемоизацией результатов вычислений. Для мемоизации
используйте ассоциативный список (словарь), который храните в
статической переменной. Использовать для этой цели глобальную переменную
<i>запрещается.</i>
</p>

<p>
Примеры вызова процедур сервером тестирования:
</p>

<pre class="example" id="org659a0ba">
  (begin
    (display (memoized-factorial 10)) (newline)
    (display (memoized-factorial 50)) (newline))

  3628800
  30414093201713378043612608166064768844377641568960512000000000000
</pre>
</div>
<div id="outline-container-org263335e" class="outline-3">
<h3 id="org263335e"><span class="section-number-3">1.1.</span> Решение</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">memoized-factorial</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>known-results '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>n<span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>= n <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>assoc n known-results<span style="color: #c678dd;">)</span> -&gt; <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>res<span style="color: #98be65;">)</span> res<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>res <span style="color: #51afef;">(</span>* n <span style="color: #c678dd;">(</span>memoized-factorial <span style="color: #98be65;">(</span>- n <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                    <span style="color: #98be65;">(</span><span style="color: #51afef;">begin</span> <span style="color: #a9a1e1;">(</span>cons '<span style="color: #51afef;">(</span>n res<span style="color: #51afef;">)</span> known-results<span style="color: #a9a1e1;">)</span>
                           res<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3549189" class="outline-3">
<h3 id="org3549189"><span class="section-number-3">1.2.</span> Тесты</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">begin</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>memoized-factorial <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>memoized-factorial <span style="color: #da8548; font-weight: bold;">20</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>memoized-factorial <span style="color: #da8548; font-weight: bold;">50</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
3628800
2432902008176640000
30414093201713378043612608166064768844377641568960512000000000000
</pre>
</div>
</div>
</div>

<div id="outline-container-отложенные-вычисления" class="outline-2">
<h2 id="отложенные-вычисления"><span class="section-number-2">2.</span> 2. Отложенные вычисления</h2>
<div class="outline-text-2" id="text-отложенные-вычисления">
<p>
Используя средства языка Scheme для отложенных вычислений, реализуйте
средства для работы с бесконечными «ленивыми» точечными парами и
списками:
</p>

<ul class="org-ul">
<li><p>
Гигиенический макрос <i>(lazy-cons a b),</i> конструирующий ленивую
точечную пару вида <i>(значение-a . обещание-вычислить-значение-b).</i>
Почему макрос в данном случае предпочтительнее процедуры?
</p>
<ul class="org-ul">
<li>Из-за порядка вычислений</li>
</ul>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define-syntax</span> <span style="color: #dcaeea;">lazy-cons</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">syntax-rules</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>lazy-cons a b<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">delay</span> <span style="color: #51afef;">(</span>cons a b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div></li>
<li><p>
Процедуру <i>(lazy-car p),</i> возвращающую значение 1-го элемента
«ленивой» точечной пары <i>p.</i>
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lazy-car</span> p<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>car <span style="color: #98be65;">(</span><span style="color: #51afef;">force</span> p<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div></li>
<li><p>
Процедуру <i>(lazy-cdr p),</i> возвращающую значение 2-го элемента
«ленивой» точечной пары <i>p.</i>
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lazy-cdr</span> p<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>cdr <span style="color: #98be65;">(</span><span style="color: #51afef;">force</span> p<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div></li>
</ul>

<p>
На их основе определите:
</p>

<ul class="org-ul">
<li><p>
Процедуру (lazy-head xs k), возвращающую значение k первых элементов
«ленивого» списка xs в виде списка.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lazy-head</span> xs k<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">loop</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>xs xs<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>k k<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>res '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= k <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>reverse res<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>loop <span style="color: #51afef;">(</span>lazy-cdr xs<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>- k <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>cons <span style="color: #c678dd;">(</span>lazy-car xs<span style="color: #c678dd;">)</span> res<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div></li>
<li><p>
Процедуру (lazy-ref xs k), возвращающую значение k-го элементa
«ленивого» списка xs.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lazy-ref</span> xs k<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">loop</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>xs xs<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>k k<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">if</span> <span style="color: #a9a1e1;">(</span>= k <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>lazy-car xs<span style="color: #a9a1e1;">)</span>
        <span style="color: #a9a1e1;">(</span>loop <span style="color: #51afef;">(</span>lazy-cdr xs<span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span>- k <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div></li>
</ul>

<p>
Продемонстрируйте работу процедур на примере бесконечного списка
натуральных чисел. Для этого определите процедуру-генератор (naturals
start), возвращающую бесконечный «ленивый» список натуральных чисел,
начиная с числа start.
</p>

<p>
Примеры вызова процедур сервером тестирования:
</p>

<pre class="example" id="org5a4dfc5">
  (display (lazy-head (naturals 10) 12))
  (10 11 12 13 14 15 16 17 18 19 20 21)
</pre>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">naturals</span> start<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>lazy-cons start <span style="color: #98be65;">(</span>naturals <span style="color: #a9a1e1;">(</span>+ start <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>lazy-head <span style="color: #98be65;">(</span>naturals <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #98be65;">)</span> <span style="color: #da8548; font-weight: bold;">12</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
(10 11 12 13 14 15 16 17 18 19 20 21)
</pre>


<p>
Реализуйте процедуру (lazy-factorial n), которая возвращает значение n!,
получая его из n-го элемента бесконечного списка факториалов.
</p>

<p>
Примеры вызова процедур сервером тестирования:
</p>

<pre class="example" id="org8bed9d7">
  (begin
    (display (lazy-factorial 10)) (newline)
    (display (lazy-factorial 50)) (newline))

  3628800
  30414093201713378043612608166064768844377641568960512000000000000
</pre>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">factorials</span> start val<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>lazy-cons val <span style="color: #98be65;">(</span>factorials <span style="color: #a9a1e1;">(</span>+ start <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>* val <span style="color: #51afef;">(</span>+ start <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">lazy-factorial</span> n<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>lazy-ref <span style="color: #98be65;">(</span>factorials <span style="color: #da8548; font-weight: bold;">0</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span> n<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">begin</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>lazy-factorial <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>lazy-factorial <span style="color: #da8548; font-weight: bold;">50</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>lazy-factorial  <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>lazy-factorial  <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span>display <span style="color: #98be65;">(</span>lazy-factorial  <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>newline<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
3628800
30414093201713378043612608166064768844377641568960512000000000000
1
2
1
</pre>
</div>
</div>

<div id="outline-container-чтение-из-потока" class="outline-2">
<h2 id="чтение-из-потока"><span class="section-number-2">3.</span> 3. Чтение из потока</h2>
<div class="outline-text-2" id="text-чтение-из-потока">
<p>
Напишите процедуру (read-words), осуществляющую чтение слов, разделенных
пробельными символами, из стандартного потока (порта) ввода (сервер
тестирования направляет в этот поток текстовый файл с примером). Слова в
потоке разделены одним или более пробельными символами. Также пробельные
символы могут присутствовать перед первым словом и после последнего
слова, такие пробельные символы должны игнорироваться. Признак конца
файла означает окончание ввода. Процедура должна возвращать список строк
(один элемент списка &#x2014; одно слово в строке). Для пустого файла или
файла, содержащего только пробелы, процедура должна возвращать пустой
список.
</p>

<p>
Анализ потока символов осуществляйте непосредственно при чтении файла,
для чего используйте встроенные процедуры read-char, peek-char,
eof-object? и встроенные предикаты классификации символов.
</p>

<p>
Пример входных данных (⋅ &#x2014; пробел, ¶ &#x2014; конец строки):
</p>

<pre class="example" id="org6879892">
⋅⋅one⋅two⋅three⋅⋅⋅¶ four⋅five⋅⋅six⋅⋅¶
</pre>

<p>
Результат вызова процедуры для этих входных данных:
</p>

<pre class="example" id="orgaefec23">
(read-words) ⇒ ("one" "two" "three" "four" "five" "six")
</pre>
</div>

<div id="outline-container-org93d9122" class="outline-3">
<h3 id="org93d9122"><span class="section-number-3">3.1.</span> Решение</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">read-words</span><span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">loop</span> <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>res '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span>
             <span style="color: #a9a1e1;">(</span>word '<span style="color: #51afef;">()</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #51afef;">let</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span>cur <span style="color: #c678dd;">(</span>read-char<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
      <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">cond</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>eof-object? cur<span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span>reverse res<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>char-whitespace? cur<span style="color: #c678dd;">)</span>
             <span style="color: #c678dd;">(</span><span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>null? word<span style="color: #98be65;">)</span>
                 <span style="color: #98be65;">(</span>loop res word<span style="color: #98be65;">)</span>
                 <span style="color: #98be65;">(</span>loop <span style="color: #a9a1e1;">(</span>cons <span style="color: #51afef;">(</span>list-&gt;string <span style="color: #c678dd;">(</span>reverse word<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> res<span style="color: #a9a1e1;">)</span>
                       '<span style="color: #a9a1e1;">()</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">else</span> <span style="color: #c678dd;">(</span>loop res <span style="color: #98be65;">(</span>cons cur word<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org3e8c231" class="outline-3">
<h3 id="org3e8c231"><span class="section-number-3">3.2.</span> Тесты</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">with-output-to-file</span> <span style="color: #98be65;">"home4.test"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
                                   <span style="color: #98be65;">(</span>display <span style="color: #98be65;">"  one two three\n four five  six  \n"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">with-input-from-file</span> <span style="color: #98be65;">"home4.test"</span> <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">()</span>
                                    <span style="color: #98be65;">(</span>write <span style="color: #a9a1e1;">(</span>read-words<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
("one" "two" "three" "four" "five" "six")
</pre>
</div>
</div>
</div>

<div id="outline-container-структуры-записи" class="outline-2">
<h2 id="структуры-записи"><span class="section-number-2">4.</span> 4. Структуры (записи)</h2>
<div class="outline-text-2" id="text-структуры-записи">
<p>
Используя средства языка Scheme для метапрограммирования, реализуйте
каркас поддержки типа данных «структура» («запись»). Пусть объявление
нового типа «структура» осуществляется с помощью вызова (define-struct
тип-структуры (имя-поля-1 имя-поля-2 &#x2026; имя-поля-n). Тогда после
объявления структуры программисту становятся доступны:
</p>

<ul class="org-ul">
<li>Процедура &#x2014; конструктор структуры вида (make-тип-структуры
значение-поля-1 значение-поля-2 &#x2026; значение-поля-n), возвращающий
структуру, поля которой инициализированы перечисленными значениями.</li>
<li>Предикат типа вида (тип-структуры? объект), возврщающая #t если объект
является структурой типа тип-структуры и #f в противном случае.</li>
<li>Процедуры для получения значения каждого из полей структуры вида
(тип-структуры-имя-поля объект).</li>
<li>Процедуры модификации каждого из полей структуры вида
(set-тип-структуры-имя-поля! объект новое-значение).</li>
</ul>

<p>
Пример использования каркаса:
</p>

<pre class="example" id="orgfab7637">
(define-struct pos (row col)) ; Объявление типа pos
(define p (make-pos 1 2))     ; Создание значения типа pos

(pos? p)    ⇒ #t

(pos-row p) ⇒ 1
(pos-col p) ⇒ 2

(set-pos-row! p 3) ; Изменение значения в поле row
(set-pos-col! p 4) ; Изменение значения в поле col

(pos-row p) ⇒ 3
(pos-col p) ⇒ 4
</pre>

<p>
Рекомендация. Для более короткой записи решения можно (но не
обязательно) использовать квазицитирование (quasiquotation).
</p>

<p>
Важно! Если в программе используются гигиенические макросы и эта
программа будет выполнена в среде guile 1.8.x (в том числе на сервере
тестирования), то следует подключить модуль поддержки таких макросов,
написав в начале программы следующую строку:
</p>

<pre class="example" id="org5b076ff">
(use-syntax (ice-9 syncase))
</pre>
</div>

<div id="outline-container-orge07b145" class="outline-3">
<h3 id="orge07b145"><span class="section-number-3">4.1.</span> Решение</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define-syntax</span> <span style="color: #dcaeea;">define-struct</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">syntax-rules</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ sym-name sym-fields<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">loop</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>name <span style="color: #98be65;">(</span>symbol-&gt;string 'sym-name<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                <span style="color: #c678dd;">(</span>fields <span style="color: #98be65;">(</span><span style="color: #51afef;">map</span> symbol-&gt;string 'sym-fields<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                <span style="color: #c678dd;">(</span>i <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>null? fields<span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span>eval `<span style="color: #98be65;">(</span><span style="color: #51afef;">begin</span> <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">define</span> <span style="color: #51afef;">(</span>,<span style="color: #c678dd;">(</span>string-&gt;symbol <span style="color: #98be65;">(</span>string-append <span style="color: #98be65;">"make-"</span>
                                                                  name<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                                  . vals<span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span>list-&gt;vector <span style="color: #c678dd;">(</span>cons '_struct <span style="color: #98be65;">(</span>cons 'sym-name vals<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                         <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">define</span> <span style="color: #51afef;">(</span>,<span style="color: #c678dd;">(</span>string-&gt;symbol <span style="color: #98be65;">(</span>string-append name
                                                                  <span style="color: #98be65;">"?"</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                                  obj<span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span><span style="color: #51afef;">and</span> <span style="color: #c678dd;">(</span>vector? obj<span style="color: #c678dd;">)</span>
                                <span style="color: #c678dd;">(</span>eqv? '_struct <span style="color: #98be65;">(</span>vector-ref obj <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                                <span style="color: #c678dd;">(</span>eqv? 'sym-name <span style="color: #98be65;">(</span>vector-ref obj <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                 <span style="color: #98be65;">(</span>interaction-environment<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
           <span style="color: #c678dd;">(</span><span style="color: #51afef;">begin</span> <span style="color: #98be65;">(</span>eval `<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">begin</span> <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span>,<span style="color: #98be65;">(</span>string-&gt;symbol <span style="color: #a9a1e1;">(</span>string-append name
                                                                         <span style="color: #98be65;">"-"</span>
                                                                         <span style="color: #51afef;">(</span>car fields<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                                         obj<span style="color: #c678dd;">)</span>
                                  <span style="color: #c678dd;">(</span>vector-ref obj ,i<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                                <span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span>,<span style="color: #98be65;">(</span>string-&gt;symbol <span style="color: #a9a1e1;">(</span>string-append <span style="color: #98be65;">"set-"</span>
                                                                         name
                                                                         <span style="color: #98be65;">"-"</span>
                                                                         <span style="color: #51afef;">(</span>car fields<span style="color: #51afef;">)</span>
                                                                         <span style="color: #98be65;">"!"</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                                         obj
                                         val<span style="color: #c678dd;">)</span>
                                  <span style="color: #c678dd;">(</span>vector-set! obj ,i val<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                        <span style="color: #a9a1e1;">(</span>interaction-environment<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                  <span style="color: #98be65;">(</span>loop name <span style="color: #a9a1e1;">(</span>cdr fields<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>+ i <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8bc108e" class="outline-3">
<h3 id="org8bc108e"><span class="section-number-3">4.2.</span> Тесты</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span>load <span style="color: #98be65;">"./unit-test.scm"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>define-struct pos <span style="color: #c678dd;">(</span>row col<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #5B6268;">; </span><span style="color: #5B6268;">&#1054;&#1073;&#1098;&#1103;&#1074;&#1083;&#1077;&#1085;&#1080;&#1077; &#1090;&#1080;&#1087;&#1072; pos</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">p</span> <span style="color: #c678dd;">(</span>make-pos <span style="color: #da8548; font-weight: bold;">1</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>     <span style="color: #5B6268;">; </span><span style="color: #5B6268;">&#1057;&#1086;&#1079;&#1076;&#1072;&#1085;&#1080;&#1077; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1090;&#1080;&#1087;&#1072; pos</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">struct-tests</span>
  <span style="color: #c678dd;">(</span>list <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>pos? p<span style="color: #a9a1e1;">)</span> #t<span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>pos-row p<span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>pos-col p<span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">2</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">begin</span>
                <span style="color: #51afef;">(</span>set-pos-row! p <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span>set-pos-col! p <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #51afef;">)</span>
                <span style="color: #51afef;">(</span>pos-row p<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
              <span style="color: #da8548; font-weight: bold;">3</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>pos-col p<span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>run-tests struct-tests<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
Test 1: (pos? p) ok
Test 2: (pos-row p) ok
Test 3: (pos-col p) ok
Test 4: (begin (set-pos-row! p 3) (set-pos-col! p 4) (pos-row p)) ok
Test 5: (pos-col p) ok
</pre>
</div>
</div>
</div>

<div id="outline-container-алгебраические-типы-данных" class="outline-2">
<h2 id="алгебраические-типы-данных"><span class="section-number-2">5.</span> 5. Алгебраические типы данных</h2>
<div class="outline-text-2" id="text-алгебраические-типы-данных">
<p>
Используя средства языка Scheme для метапрограммирования, реализуйте
каркас поддержки алгебраических типов данных.
</p>

<p>
Алгебраический тип данных &#x2014; составной тип, получаемый путем комбинации
значений других типов (полей) с помощью функций-конструкторов. Такой тип
допускает различные комбинации полей &#x2014; варианты. Для каждого из
вариантов предусматривается свой конструктор. Все варианты типа
рассматриваются как один полиморфный тип. Функции (процедуры),
работающие с алгебраическим типом, предусматривают отдельные ветви
вычислений для каждого из вариантов.
</p>

<p>
Пример. Необходимо вычислять периметры геометрических фигур (квадратов,
прямоугольников, треугольников) и длины окружностей. Для этого в
программе определен тип фигура, который может принимать значения
квадрат, прямоугольник, треугольник, окружность. Значения создаются с
помощью конструкторов (для каждой фигуры &#x2014; свой конструктор) &#x2014;
процедур, принимающих в качестве аргументов длины сторон (1, 2 или 3
аргумента соответственно) или радиус (для окружности) и возвращающих
значение типа фигура:
</p>

<pre class="example" id="org2977da4">
; Определяем тип
;
(define-data figure ((square a)
                    (rectangle a b)
                    (triangle a b c)
                    (circle r)))

; Определяем значения типа
;
(define s (square 10))
(define r (rectangle 10 20))
(define t (triangle 10 20 30))
(define c (circle 10))

; Пусть определение алгебраического типа вводит
; не только конструкторы, но и предикат этого типа:
;
(and (figure? s)
    (figure? r)
    (figure? t)
    (figure? c)) ⇒ #t
</pre>

<p>
Функция расчета периметра или длины окружности &#x2014; единая для всех
фигур, принимает значение типа фигура и возвращает значение, вычисленное
по формуле, выбранной в соответствии с вариантом фигуры:
</p>

<pre class="example" id="org963c09a">
(define pi (acos -1)) ; Для окружности

(define (perim f)
  (match f
         ((square a)       (* 4 a))
         ((rectangle a b)  (* 2 (+ a b)))
         ((triangle a b c) (+ a b c))
         ((circle r)       (* 2 pi r))))

(perim s) ⇒ 40
(perim r) ⇒ 60
(perim t) ⇒ 60
</pre>

<p>
Здесь <code>match</code> &#x2014; сопоставление с образцом. В данном примере при
вычислении <code>(perim s)</code> значение <code>s</code> будет сопоставлено с образцом
<code>(square a)</code>. При этом будет осуществлена подстановка фактического
значения <code>a</code>, содержащегося в <code>s</code>, на место а в выражении <code>(* 4 a)</code>
справа от образца. Вычисленое значение будет возвращено из конструкции
<code>match</code>.
</p>

<p>
<b>Рекомендации.</b> Для более короткой записи решения можно (но не
обязательно) использовать квазицитирование (quasiquotation). По
литературе и ресурсам Интернет ознакомьтесь с тем, как работает
сопоставление с образцом в других языках программирования.
</p>
</div>
<div id="outline-container-org8e0d02a" class="outline-3">
<h3 id="org8e0d02a"><span class="section-number-3">5.1.</span> Решение</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define-syntax</span> <span style="color: #dcaeea;">define-data</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">syntax-rules</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ name _constructors<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">let</span> <span style="color: #c678dd;">loop</span> <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>constructors '_constructors<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
       <span style="color: #51afef;">(</span><span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span>null? constructors<span style="color: #c678dd;">)</span>
           <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1084; &#1087;&#1088;&#1077;&#1076;&#1080;&#1082;&#1072;&#1090;</span>
           <span style="color: #c678dd;">(</span>eval `<span style="color: #98be65;">(</span><span style="color: #51afef;">define</span> <span style="color: #a9a1e1;">(</span>,<span style="color: #51afef;">(</span>string-&gt;symbol <span style="color: #c678dd;">(</span>string-append <span style="color: #98be65;">(</span>symbol-&gt;string 'name<span style="color: #98be65;">)</span>
                                                           <span style="color: #98be65;">"?"</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                           obj<span style="color: #a9a1e1;">)</span>
                    <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">and</span> <span style="color: #51afef;">(</span>list? obj<span style="color: #51afef;">)</span>
                         <span style="color: #51afef;">(</span>eqv? '_data <span style="color: #c678dd;">(</span>car obj<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                         <span style="color: #51afef;">(</span>eqv? 'name <span style="color: #c678dd;">(</span>cadr obj<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                 <span style="color: #98be65;">(</span>interaction-environment<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
           <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#1086;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1080;&#1084; &#1082;&#1086;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1086;&#1088;</span>
           <span style="color: #c678dd;">(</span><span style="color: #51afef;">begin</span> <span style="color: #98be65;">(</span>eval `<span style="color: #a9a1e1;">(</span><span style="color: #51afef;">define</span> <span style="color: #51afef;">(</span>,<span style="color: #c678dd;">(</span>caar constructors<span style="color: #c678dd;">)</span>
                                  . params<span style="color: #51afef;">)</span>
                           <span style="color: #51afef;">(</span>append <span style="color: #c678dd;">(</span>list '_data
                                         'name
                                         ',<span style="color: #98be65;">(</span>caar constructors<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
                                   params<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
                        <span style="color: #a9a1e1;">(</span>interaction-environment<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
                  <span style="color: #98be65;">(</span>loop <span style="color: #a9a1e1;">(</span>cdr constructors<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define-syntax</span> <span style="color: #dcaeea;">match</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">syntax-rules</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ val <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>name params ...<span style="color: #c678dd;">)</span> expr<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span>apply <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>params ...<span style="color: #c678dd;">)</span>
              expr<span style="color: #51afef;">)</span>
            <span style="color: #51afef;">(</span>cdddr val<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ val <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>name params ...<span style="color: #c678dd;">)</span> expr<span style="color: #51afef;">)</span> patterns ...<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">if</span> <span style="color: #51afef;">(</span>eqv? 'name <span style="color: #c678dd;">(</span>caddr val<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span>apply <span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>params ...<span style="color: #98be65;">)</span>
                  expr<span style="color: #c678dd;">)</span>
                <span style="color: #c678dd;">(</span>cdddr val<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
         <span style="color: #51afef;">(</span><span style="color: #51afef;">match</span> val patterns ...<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8823312" class="outline-3">
<h3 id="org8823312"><span class="section-number-3">5.2.</span> Тесты</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1090;&#1080;&#1087;</span>
<span style="color: #51afef;">(</span>define-data figure <span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>square a<span style="color: #98be65;">)</span>
                     <span style="color: #98be65;">(</span>rectangle a b<span style="color: #98be65;">)</span>
                     <span style="color: #98be65;">(</span>triangle a b c<span style="color: #98be65;">)</span>
                     <span style="color: #98be65;">(</span>circle r<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#1054;&#1087;&#1088;&#1077;&#1076;&#1077;&#1083;&#1103;&#1077;&#1084; &#1079;&#1085;&#1072;&#1095;&#1077;&#1085;&#1080;&#1103; &#1090;&#1080;&#1087;&#1072;</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">s</span> <span style="color: #c678dd;">(</span>square <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">r</span> <span style="color: #c678dd;">(</span>rectangle <span style="color: #da8548; font-weight: bold;">10</span> <span style="color: #da8548; font-weight: bold;">20</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">t</span> <span style="color: #c678dd;">(</span>triangle <span style="color: #da8548; font-weight: bold;">10</span> <span style="color: #da8548; font-weight: bold;">20</span> <span style="color: #da8548; font-weight: bold;">30</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">c</span> <span style="color: #c678dd;">(</span>circle <span style="color: #da8548; font-weight: bold;">10</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span><span style="color: #51afef;">and</span> <span style="color: #98be65;">(</span>figure? s<span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span>figure? r<span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span>figure? t<span style="color: #98be65;">)</span>
              <span style="color: #98be65;">(</span>figure? c<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">pi</span> <span style="color: #c678dd;">(</span>acos <span style="color: #da8548; font-weight: bold;">-1</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#1044;&#1083;&#1103; &#1086;&#1082;&#1088;&#1091;&#1078;&#1085;&#1086;&#1089;&#1090;&#1080;</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">perim</span> f<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">match</span> f
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>square a<span style="color: #a9a1e1;">)</span>       <span style="color: #a9a1e1;">(</span>* <span style="color: #da8548; font-weight: bold;">4</span> a<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>rectangle a b<span style="color: #a9a1e1;">)</span>  <span style="color: #a9a1e1;">(</span>* <span style="color: #da8548; font-weight: bold;">2</span> <span style="color: #51afef;">(</span>+ a b<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>triangle a b c<span style="color: #a9a1e1;">)</span> <span style="color: #a9a1e1;">(</span>+ a b c<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
         <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>circle r<span style="color: #a9a1e1;">)</span>       <span style="color: #a9a1e1;">(</span>* <span style="color: #da8548; font-weight: bold;">2</span> pi r<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>perim s<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>perim r<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>perim t<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>display <span style="color: #c678dd;">(</span>perim c<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">(</span>newline<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
#t
40
60
60
62.83185307179586
</pre>
</div>
</div>
</div>

<div id="outline-container-ачивки" class="outline-2">
<h2 id="ачивки"><span class="section-number-2">6.</span> «Ачивки»</h2>
<div class="outline-text-2" id="text-ачивки">
<ul class="org-ul">
<li><p>
Объяснить, как и почему работает следующий фрагмент кода:
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #51afef;">call-with-current-continuation</span>
   <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #51afef;">(</span>c<span style="color: #51afef;">)</span> c<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
  <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> x<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
 'hello<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">&lt;&#1087;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1077;&#1085;&#1080;&#1077;&gt;</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> x<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
 'hello<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> x<span style="color: #98be65;">)</span> <span style="color: #98be65;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #a9a1e1;">(</span>x<span style="color: #a9a1e1;">)</span> x<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
 'hello<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #98be65;">(</span>x<span style="color: #98be65;">)</span> x<span style="color: #c678dd;">)</span> 'hello<span style="color: #51afef;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme">'hello
</pre>
</div>

<p>
Можно догадаться, что этот код печатает <code>hello</code>, но нужно объяснить
почему. <b>+1 балл.</b>
</p></li>

<li><p>
Написать макросы <code>my-let</code> и =my-let*= без использования эллипсисов
(многоточий, <code>...</code>) (и, конечно, встроенных <code>let</code>, <code>let*</code>, <code>letrec</code>)
<b>+1 балл</b> за оба.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #51afef;">(</span><span style="color: #51afef;">define-syntax</span> <span style="color: #dcaeea;">my-let</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">syntax-rules</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>var val<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> expr<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>var<span style="color: #c678dd;">)</span>
        expr<span style="color: #51afef;">)</span> val<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>var val<span style="color: #c678dd;">)</span> . others<span style="color: #51afef;">)</span> expr<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>var<span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">(</span>my-let others
                 expr<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> val<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define-syntax</span> <span style="color: #dcaeea;">my-let*</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">syntax-rules</span> <span style="color: #98be65;">()</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>var val<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> expr<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>var<span style="color: #c678dd;">)</span>
        expr<span style="color: #51afef;">)</span> val<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span>
    <span style="color: #98be65;">(</span><span style="color: #a9a1e1;">(</span>_ <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>var val<span style="color: #c678dd;">)</span> . others<span style="color: #51afef;">)</span> expr<span style="color: #a9a1e1;">)</span>
     <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>var<span style="color: #c678dd;">)</span>
        <span style="color: #c678dd;">(</span>my-let* others
                 expr<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span> val<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>load <span style="color: #98be65;">"./unit-test.scm"</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tests</span>
  <span style="color: #c678dd;">(</span>list
   <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>my-let <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>y <span style="color: #da8548; font-weight: bold;">7</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                 <span style="color: #51afef;">(</span>+ x <span style="color: #da8548; font-weight: bold;">1</span> y<span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         <span style="color: #da8548; font-weight: bold;">13</span><span style="color: #98be65;">)</span>
   <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>my-let <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>=&gt; #f<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
           <span style="color: #51afef;">(</span><span style="color: #51afef;">cond</span> <span style="color: #c678dd;">(</span>#t =&gt; 'ok<span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
         ok<span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>run-tests tests<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">tests</span>
  <span style="color: #c678dd;">(</span>list
   <span style="color: #98be65;">(</span>test <span style="color: #a9a1e1;">(</span>my-let* <span style="color: #51afef;">(</span><span style="color: #c678dd;">(</span>x <span style="color: #da8548; font-weight: bold;">5</span><span style="color: #c678dd;">)</span> <span style="color: #c678dd;">(</span>y <span style="color: #98be65;">(</span>+ x <span style="color: #da8548; font-weight: bold;">7</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>
                  y<span style="color: #a9a1e1;">)</span> <span style="color: #da8548; font-weight: bold;">12</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span><span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span>run-tests tests<span style="color: #51afef;">)</span>
</pre>
</div>

<pre class="example">
Test 1: (my-let ((x 5) (y 7)) (+ x 1 y)) ok
Test 2: (my-let ((=&gt; #f)) (cond (#t =&gt; (quote ok)))) ok
Test 1: (my-let* ((x 5) (y (+ x 7))) y) ok
</pre></li>

<li><p>
Объяснить, почему от перемены мест слагаемых меняется сумма в этом
примере <b>(1 балл):</b> <img src="pics/wtf.png" alt="wtf.png" />
</p>
<div class="org-src-container">
<pre class="src src-scheme">
<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">r</span> #f<span style="color: #51afef;">)</span>

<span style="color: #51afef;">(</span><span style="color: #51afef;">define</span> <span style="color: #c678dd;">(</span><span style="color: #c678dd;">g</span> x<span style="color: #c678dd;">)</span>
  <span style="color: #c678dd;">(</span><span style="color: #51afef;">set!</span> x <span style="color: #98be65;">(</span>+
           x <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">x &#1080;&#1079; &#1087;&#1077;&#1088;&#1074;&#1086;&#1075;&#1086; &#1074;&#1099;&#1079;&#1086;&#1074;&#1072; g, &#1090;.&#1082;. &#1073;&#1091;&#1076;&#1077;&#1090; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1086; &#1074; &#1089;&#1090;&#1077;&#1082;&#1077;</span>
           <span style="color: #a9a1e1;">(</span><span style="color: #51afef;">call-with-current-continuation</span>
            <span style="color: #51afef;">(</span><span style="color: #51afef;">lambda</span> <span style="color: #c678dd;">(</span>ret<span style="color: #c678dd;">)</span>
              <span style="color: #c678dd;">(</span><span style="color: #51afef;">set!</span> r ret<span style="color: #c678dd;">)</span>
              <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #51afef;">)</span><span style="color: #a9a1e1;">)</span>
           x <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">x &#1080;&#1079; &#1087;&#1086;&#1089;&#1083;&#1077;&#1076;&#1085;&#1077;&#1075;&#1086; &#1074;&#1099;&#1079;&#1086;&#1074;&#1072;, &#1090;.&#1082;. set! &#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1090; &#1087;&#1077;&#1088;&#1077;&#1084;&#1077;&#1085;&#1085;&#1091;&#1102; &#1089;&#1086;&#1093;&#1088;&#1072;&#1085;&#1077;&#1085;&#1085;&#1091;&#1102; &#1074; &#1082;&#1086;&#1085;&#1090;&#1080;&#1085;&#1091;&#1072;&#1094;&#1080;&#1080;</span>
           <span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
  x<span style="color: #51afef;">)</span>
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Starovoytov Alexandr</p>
<p class="date">Created: 2021-12-10 Fri 00:33</p>
</div>
</body>
</html>
